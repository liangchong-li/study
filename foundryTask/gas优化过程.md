初始代码

```solidity
function add(int256 a, int256 b) public pure returns (int256 res) {
    return res = a + b;
}

function sub(int256 a, int256 b) public pure returns (int256 res) {
    return res = a - b;
}
```



gas报告

```
╭----------------------------------------+-----------------+-----+--------+-----+---------╮
| src/Calculator.sol:Calculator Contract |                 |     |        |     |         |
+=========================================================================================+
| Deployment Cost                        | Deployment Size |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| 177993                                 | 607             |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
|                                        |                 |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| Function Name                          | Min             | Avg | Median | Max | # Calls |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| add                                    | 966             | 966 | 966    | 966 | 257     |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| sub                                    | 985             | 985 | 985    | 985 | 257     |
╰----------------------------------------+-----------------+-----+--------+-----+---------
```



第一次优化，返回值不使用变量

```solidity
function add(int256 a, int256 b) public pure returns (int256) {
    return a + b;
}

function sub(int256 a, int256 b) public pure returns (int256) {
    return a - b;
}
```





gas报告

```
╭----------------------------------------+-----------------+-----+--------+-----+---------╮
| src/Calculator.sol:Calculator Contract |                 |     |        |     |         |
+=========================================================================================+
| Deployment Cost                        | Deployment Size |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| 177993                                 | 607             |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
|                                        |                 |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| Function Name                          | Min             | Avg | Median | Max | # Calls |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| add                                    | 966             | 966 | 966    | 966 | 257     |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| sub                                    | 985             | 985 | 985    | 985 | 257     |
╰----------------------------------------+-----------------+-----+--------+-----+---------╯
```




没有任何提升。

第二次优化，汇编优化

```solidity
function add(int256 a, int256 b) public pure returns (int256 res) {
    // return a + b;
    assembly {
        res := add(a, b)
    }
}

function sub(int256 a, int256 b) public pure returns (int256 res) {
    // return a - b;
    assembly {
        res := sub(a, b)
    }
}
```





gas报告

```
╭----------------------------------------+-----------------+-----+--------+-----+---------╮
| src/Calculator.sol:Calculator Contract |                 |     |        |     |         |
+=========================================================================================+
| Deployment Cost                        | Deployment Size |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| 136857                                 | 415             |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
|                                        |                 |     |        |     |         |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| Function Name                          | Min             | Avg | Median | Max | # Calls |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| add                                    | 747             | 747 | 747    | 747 | 257     |
|----------------------------------------+-----------------+-----+--------+-----+---------|
| sub                                    | 769             | 769 | 769    | 769 | 257     |
╰----------------------------------------+-----------------+-----+--------+-----+---------╯
```



